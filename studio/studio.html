<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; frame-src *; style-src * 'unsafe-inline';">
	<title>InfiniBI Studio</title>
	<link rel="icon" type="image/svg+xml" href="logo.svg">
    
	<!-- Stylesheets -->
	<link rel="stylesheet" href="styles.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
	<!-- Welcome Modal -->
	<div id="welcome-modal" class="welcome-modal">
		<div class="welcome-modal-content">
			<div class="welcome-header">
				<div class="welcome-logo">
					<img src="logo.svg" alt="InfiniBI" class="welcome-logo-img">
					<span class="welcome-brand">InfiniBI Studio</span>
				</div>
				<button class="welcome-close" onclick="closeWelcomeModal()" title="Close">
					<i class="fas fa-times"></i>
				</button>
			</div>
			
			<div class="welcome-body">
				<h2>Welcome to InfiniBI Studio</h2>
				<p class="welcome-subtitle">Design professional BI architectures with ease</p>
				
				<div class="welcome-features">
					<div class="welcome-feature">
						<div class="feature-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
							<i class="fas fa-layer-group"></i>
						</div>
						<div class="feature-text">
							<h4>Drag & Drop Components</h4>
							<p>50+ pre-built data sources, warehouses, and BI tools</p>
						</div>
					</div>
					<div class="welcome-feature">
						<div class="feature-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
							<i class="fas fa-bezier-curve"></i>
						</div>
						<div class="feature-text">
							<h4>Smart Connections</h4>
							<p>Create data flow diagrams with intelligent routing</p>
						</div>
					</div>
					<div class="welcome-feature">
						<div class="feature-icon" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9);">
							<i class="fas fa-file-export"></i>
						</div>
						<div class="feature-text">
							<h4>Export Anywhere</h4>
							<p>PNG, PDF, HTML - share your designs professionally</p>
						</div>
					</div>
					<div class="welcome-feature">
						<div class="feature-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
							<i class="fas fa-copy"></i>
						</div>
						<div class="feature-text">
							<h4>Multi-Page Projects</h4>
							<p>Organize complex architectures across multiple pages</p>
						</div>
					</div>
				</div>
			</div>
			
			<div class="welcome-footer">
				<div class="welcome-actions">
					<button class="welcome-btn welcome-btn-secondary" onclick="loadDemoProject()">
						<i class="fas fa-play-circle"></i>
						Load Demo Project
					</button>
					<button class="welcome-btn welcome-btn-primary" onclick="closeWelcomeModal()">
						<i class="fas fa-plus-circle"></i>
						Start Fresh
					</button>
				</div>
				<label class="welcome-checkbox">
					<input type="checkbox" id="welcome-dont-show" onchange="toggleWelcomePreference()">
					<span>Don't show this again</span>
				</label>
			</div>
		</div>
	</div>

	<div class="playground-container">
		<!-- Header -->
		<header class="playground-header">
			<div class="header-content">
				<nav class="header-nav">
					<div class="app-logo">
						<img src="logo.svg" alt="InfiniBI" class="logo-img">
						<h1>InfiniBI Studio</h1>
					</div>
					<a href="studio.html" class="nav-link active">
						<i class="fas fa-project-diagram"></i> Architecture
					</a>
					<a href="databases.html" class="nav-link">
						<i class="fas fa-database"></i> Databases
					</a>
				</nav>
				<div class="header-actions">
					<!-- Utility Buttons -->
					<button class="btn btn-icon" onclick="showWelcomeModal()" title="Welcome & Getting Started">
						<i class="fas fa-question-circle"></i>
					</button>
					<button class="btn btn-icon theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
						<i class="fas fa-moon" id="theme-icon"></i>
					</button>
					<button class="btn btn-icon btn-secondary" id="settings-btn" title="Canvas Settings">
						<i class="fas fa-sliders-h"></i>
					</button>
					<button class="btn btn-icon btn-secondary" onclick="togglePresentationMode()" title="Presentation Mode - Fullscreen Canvas">
						<i class="fas fa-expand"></i>
					</button>
					<button class="btn btn-icon btn-secondary" onclick="syncDatabaseChanges()" title="Sync Database Changes">
						<i class="fas fa-sync-alt"></i>
					</button>
					
					<!-- File Management Dropdown -->
			<div class="palette-category" style="display: inline-block; margin-left: 10px; position: relative; z-index: 999998;">
				<button class="category-header" onclick="togglePaletteCategory('file-menu-header', event)" style="background: #0078d4; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
					<i class="fas fa-folder"></i>
					<span>File</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="file-menu-header" style="min-width: 200px;">
							<div class="palette-item" onclick="saveCanvas(); togglePaletteCategory('file-menu-header')" title="Save current work">
								<i class="fas fa-save" style="color: #0078d4;"></i><span>Save Canvas</span>
							</div>
							<div class="palette-item" onclick="loadCanvas(); togglePaletteCategory('file-menu-header')" title="Load saved canvas">
								<i class="fas fa-folder-open" style="color: #0078d4;"></i><span>Load Canvas</span>
							</div>
							<hr style="margin: 4px 0; border: none; border-top: 1px solid #e1e5e9;">
							<div class="palette-item" onclick="exportCanvas(); togglePaletteCategory('file-menu-header')" title="Export canvas as JSON file">
								<i class="fas fa-file-export" style="color: #10b981;"></i><span>Export JSON</span>
							</div>
							<div class="palette-item" onclick="importCanvas(); togglePaletteCategory('file-menu-header')" title="Import canvas from JSON file">
								<i class="fas fa-file-import" style="color: #6b7280;"></i><span>Import JSON</span>
							</div>
							<hr style="margin: 4px 0; border: none; border-top: 1px solid #e1e5e9;">
							<div class="palette-item" onclick="document.getElementById('settings-btn').click(); togglePaletteCategory('file-menu-header')" title="Configure canvas settings">
								<i class="fas fa-sliders-h" style="color: #6b7280;"></i><span>Canvas Settings</span>
							</div>
							<hr style="margin: 4px 0; border: none; border-top: 1px solid #e1e5e9;">
							<div class="palette-item" onclick="clearCanvas(); togglePaletteCategory('file-menu-header')" title="Clear everything">
								<i class="fas fa-trash" style="color: #dc2626;"></i><span>Clear Canvas</span>
							</div>
						</div>
					</div>
					
					<!-- Export Dropdown -->
			<div class="palette-category" style="display: inline-block; margin-left: 10px; position: relative; z-index: 999998;">
				<button class="category-header" onclick="togglePaletteCategory('export-menu-header', event)" style="background: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
					<i class="fas fa-download"></i>
					<span>Export</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="export-menu-header" style="min-width: 220px;">
							<div class="palette-item" onclick="exportToPNG(); togglePaletteCategory('export-menu-header')" title="Export as PNG image">
								<i class="fas fa-image" style="color: #10b981;"></i><span>Export PNG Image</span>
							</div>
							<hr style="margin: 4px 0; border: none; border-top: 1px solid #e1e5e9;">
							<div class="palette-item" onclick="exportToHTML(); togglePaletteCategory('export-menu-header')" title="Static HTML">
								<i class="fas fa-file-code" style="color: #3b82f6;"></i><span>Export HTML (Static)</span>
							</div>
							<div class="palette-item" onclick="exportAnimatedHTML(); togglePaletteCategory('export-menu-header')" title="Interactive HTML with animations">
								<i class="fas fa-film" style="color: #8b5cf6;"></i><span>Export HTML (Animated)</span>
							</div>
							<hr style="margin: 4px 0; border: none; border-top: 1px solid #e1e5e9;">
							<div class="palette-item" onclick="exportPDF({template: 'executive'}); togglePaletteCategory('export-menu-header')" title="Executive Summary PDF">
								<i class="fas fa-chart-line" style="color: #10b981;"></i><span>PDF - Executive Summary</span>
							</div>
							<div class="palette-item" onclick="exportPDF({template: 'presentation'}); togglePaletteCategory('export-menu-header')" title="Presentation PDF">
								<i class="fas fa-presentation-screen" style="color: #3b82f6;"></i><span>PDF - Presentation</span>
							</div>
							<div class="palette-item" onclick="exportPDF({template: 'technical'}); togglePaletteCategory('export-menu-header')" title="Technical Documentation PDF">
								<i class="fas fa-cogs" style="color: #f59e0b;"></i><span>PDF - Technical Docs</span>
							</div>
							<div class="palette-item" onclick="exportPDF({template: 'comprehensive'}); togglePaletteCategory('export-menu-header')" title="Comprehensive Review PDF">
								<i class="fas fa-file-alt" style="color: #6b7280;"></i><span>PDF - Full Review</span>
							</div>
							<div class="palette-item" onclick="exportPDF({quick: true}); togglePaletteCategory('export-menu-header')" title="Quick Snapshot PDF">
								<i class="fas fa-camera" style="color: #06b6d4;"></i><span>PDF - Quick Snapshot</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</header>

		<!-- Main Fabric Workspace -->
		<div class="fabric-workspace">
			<!-- Fabric Toolbar -->
			<div class="fabric-toolbar">
				<div class="toolbar-left">
					<!-- Page Tabs in Toolbar -->
					<div class="page-tabs-container">
						<div class="page-tabs" id="page-tabs">
							<div class="page-tab active" data-page-id="page-1">
								<span class="page-tab-name">Page 1</span>
								<button class="page-tab-close" onclick="deletePage('page-1')" title="Delete page">
									<i class="fas fa-times"></i>
								</button>
							</div>
						</div>
						<button class="page-tab-add" onclick="addNewPage()" title="Add new page">
							<i class="fas fa-plus"></i>
						</button>
					</div>
				</div>
				<div class="toolbar-right">
					<button class="toolbar-btn" id="mode-toggle-btn" onclick="playground.togglePanSelectMode()" title="Toggle Pan/Select Mode (Space)">
						<i class="fas fa-hand-paper"></i>
						<span style="margin-left: 4px; font-size: 11px;">Pan</span>
					</button>
					<button class="toolbar-btn" onclick="playground.autoArrangeCards()" title="Auto-Arrange Cards (A)">
						<i class="fas fa-project-diagram"></i>
					</button>
					<button class="toolbar-btn" onclick="playground.fitToView()" title="Fit to View (F)">
						<i class="fas fa-compress-arrows-alt"></i>
					</button>
					<!-- Tools moved to right-click context menu -->
				</div>
			</div>

			<!-- Text Formatting Toolbar (shows when text label is selected) -->
			<div class="text-format-toolbar" id="text-format-toolbar" style="display: none;">
				<div class="format-group">
					<label>Size:</label>
					<button class="format-btn" onclick="playground.setTextSize('small')" title="Small">
						<i class="fas fa-font" style="font-size: 10px;"></i>
					</button>
					<button class="format-btn" onclick="playground.setTextSize('medium')" title="Medium">
						<i class="fas fa-font" style="font-size: 14px;"></i>
					</button>
					<button class="format-btn" onclick="playground.setTextSize('large')" title="Large">
						<i class="fas fa-font" style="font-size: 18px;"></i>
					</button>
				</div>
				<div class="format-separator"></div>
				<div class="format-group">
					<button class="format-btn" id="bold-btn" onclick="playground.toggleBold()" title="Bold">
						<i class="fas fa-bold"></i>
					</button>
				</div>
				<div class="format-separator"></div>
				<div class="format-group">
					<label>Text Color:</label>
					<input type="color" id="text-color-picker" value="#ffffff" onchange="playground.setTextColor(this.value)" title="Text Color">
				</div>
				<div class="format-separator"></div>
				<div class="format-group">
					<label>Background:</label>
					<input type="color" id="bg-color-picker" value="#000000" onchange="playground.setBackgroundColor(this.value)" title="Background Color">
					<button class="format-btn" onclick="playground.toggleBackgroundTransparent()" title="Toggle Transparent Background">
						<i class="fas fa-fill-drip"></i>
					</button>
				</div>
				<div class="format-separator"></div>
				<div class="format-group">
					<label>Border:</label>
					<button class="format-btn" onclick="playground.toggleBorder()" title="Toggle Border">
						<i class="fas fa-border-style"></i>
					</button>
				</div>
			</div>

			<!-- Component Palette with Categories -->
			<div class="component-palette" id="component-palette">
				<div class="palette-categories">
					<!-- Data Sources Category -->
			<div class="palette-category">
				<button class="category-header" onclick="togglePaletteCategory('data-sources', event)">
					<i class="fas fa-database"></i>
					<span>Data Sources</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="data-sources">
							<div class="palette-item database-selector-btn" data-type="database-selector" title="Add Databases">
								<i class="fas fa-database"></i><span>Databases</span>
							</div>
						<div class="palette-item" draggable="true" data-type="raspberry-pi" title="Raspberry Pi Edge Node">
							<i class="fab fa-raspberry-pi" style="color: #d61c4e;"></i><span>Raspberry Pi</span>
						</div>
							<div class="palette-item" draggable="true" data-type="api" title="API Endpoint">
								<i class="fas fa-plug"></i><span>API</span>
							</div>
							<div class="palette-item" draggable="true" data-type="file-source" title="File Source">
								<i class="fas fa-file"></i><span>Files</span>
							</div>
							<div class="palette-item" draggable="true" data-type="stream" title="Data Stream">
								<i class="fas fa-stream"></i><span>Stream</span>
							</div>
							<div class="palette-item" draggable="true" data-type="web-scrape" title="Web Scraping">
								<i class="fas fa-spider"></i><span>Web Scrape</span>
							</div>
						</div>
					</div>

			<!-- Storage & Processing Category -->
			<div class="palette-category">
				<button class="category-header" onclick="togglePaletteCategory('storage-processing', event)">
					<i class="fas fa-server"></i>
					<span>Storage & Processing</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="storage-processing">
							<div class="palette-item" draggable="true" data-type="warehouse" title="Data Warehouse">
								<i class="fas fa-warehouse"></i><span>Warehouse</span>
							</div>
							<div class="palette-item" draggable="true" data-type="lakehouse" title="Lakehouse">
								<i class="fas fa-water"></i><span>Lakehouse</span>
							</div>
							<div class="palette-item" draggable="true" data-type="data-lake" title="Data Lake">
								<i class="fas fa-lake"></i><span>Data Lake</span>
							</div>
							<div class="palette-item" draggable="true" data-type="table" title="Table">
								<i class="fas fa-table"></i><span>Table</span>
							</div>
							<div class="palette-item" draggable="true" data-type="pipeline" title="Data Pipeline">
								<i class="fas fa-arrows-rotate"></i><span>Pipeline</span>
							</div>
							<div class="palette-item" draggable="true" data-type="dataflow" title="Dataflow">
								<i class="fas fa-diagram-project"></i><span>Dataflow</span>
							</div>
							<div class="palette-item" draggable="true" data-type="etl" title="ETL Process">
								<i class="fas fa-cogs"></i><span>ETL</span>
							</div>
						</div>
					</div>

					<!-- Containers & Groups Category -->
			<div class="palette-category">
				<button class="category-header" onclick="togglePaletteCategory('containers-groups', event)">
					<i class="fas fa-object-group"></i>
					<span>Containers & Groups</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="containers-groups">
							<div class="palette-item" draggable="true" data-type="api-collection" title="API Collection - Groups tables from API endpoint">
								<i class="fas fa-layer-group" style="color: #06b6d4;"></i><span>API Collection</span>
							</div>
							<div class="palette-item" draggable="true" data-type="schema-container" title="Schema Container - Groups tables from same schema">
								<i class="fas fa-folder-open" style="color: #10b981;"></i><span>Schema</span>
							</div>
							<div class="palette-item" draggable="true" data-type="table-group" title="Table Group - Custom grouping for related tables">
								<i class="fas fa-th-list" style="color: #f59e0b;"></i><span>Table Group</span>
							</div>
							<div class="palette-item" draggable="true" data-type="process-container" title="Process Container - Groups transformation steps">
								<i class="fas fa-cogs" style="color: #8b5cf6;"></i><span>Process Group</span>
							</div>
							<div class="palette-item" draggable="true" data-type="zone-container" title="Data Zone - Large area grouping (Landing/Raw/Curated)">
								<i class="fas fa-square" style="color: #6b7280;"></i><span>Data Zone</span>
							</div>
							<div class="palette-item" draggable="true" data-type="datasources-container" title="Datasources - Container for data sources">
								<i class="fas fa-database" style="color: #17a2b8;"></i><span>Datasources</span>
							</div>
							<div class="palette-item" draggable="true" data-type="onelake-container" title="One Lake - Container for OneLake items">
								<i class="fas fa-water" style="color: #20c997;"></i><span>One Lake</span>
							</div>
							<div class="palette-item" draggable="true" data-type="transformation-container" title="Transformation - Container for transformation processes">
								<i class="fas fa-exchange-alt" style="color: #fd7e14;"></i><span>Transformation</span>
							</div>
							<div class="palette-item" draggable="true" data-type="semantic-models-container" title="Semantic Models - Container for semantic models">
								<i class="fas fa-cubes" style="color: #6610f2;"></i><span>Semantic Models</span>
							</div>
							<div class="palette-item" draggable="true" data-type="reports-container" title="Reports - Container for reports and dashboards">
								<i class="fas fa-chart-bar" style="color: #e83e8c;"></i><span>Reports</span>
							</div>
						</div>
					</div>

					<!-- Medallion Architecture Category -->
			<div class="palette-category">
				<button class="category-header" onclick="togglePaletteCategory('medallion', event)">
					<i class="fas fa-layer-group"></i>
					<span>Medallion Layers</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="medallion">
							<div class="palette-item" draggable="true" data-type="bronze" title="Bronze Layer - Raw Data">
								<i class="fas fa-award" style="color: #CD7F32;"></i><span>Bronze</span>
							</div>
							<div class="palette-item" draggable="true" data-type="silver" title="Silver Layer - Cleaned Data">
								<i class="fas fa-award" style="color: #C0C0C0;"></i><span>Silver</span>
							</div>
							<div class="palette-item" draggable="true" data-type="gold" title="Gold Layer - Business Ready">
								<i class="fas fa-award" style="color: #FFD700;"></i><span>Gold</span>
							</div>
							<div class="palette-item" draggable="true" data-type="platinum" title="Platinum Layer - ML Ready">
								<i class="fas fa-award" style="color: #E5E4E2;"></i><span>Platinum</span>
							</div>
						</div>
					</div>

					<!-- Analytics & Models Category -->
			<div class="palette-category">
				<button class="category-header" onclick="togglePaletteCategory('analytics-models', event)">
					<i class="fas fa-brain"></i>
					<span>Analytics & Models</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="analytics-models">
							<div class="palette-item" draggable="true" data-type="semantic-model" title="Semantic Model">
								<i class="fas fa-cubes"></i><span>Semantic Model</span>
							</div>
							<div class="palette-item" draggable="true" data-type="dataset" title="Dataset">
								<i class="fas fa-table"></i><span>Dataset</span>
							</div>
							<div class="palette-item" draggable="true" data-type="ml-model" title="ML Model">
								<i class="fas fa-robot"></i><span>ML Model</span>
							</div>
							<div class="palette-item" draggable="true" data-type="notebook" title="Notebook">
								<i class="fas fa-book"></i><span>Notebook</span>
							</div>
							<div class="palette-item" draggable="true" data-type="experiment" title="ML Experiment">
								<i class="fas fa-flask"></i><span>Experiment</span>
							</div>
						</div>
					</div>

					<!-- Reporting & Visualization Category -->
			<div class="palette-category">
				<button class="category-header" onclick="togglePaletteCategory('reporting-viz', event)">
					<i class="fas fa-chart-bar"></i>
					<span>Reporting & Visualization</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="reporting-viz">
							<div class="palette-item" draggable="true" data-type="dashboard" title="Dashboard">
								<i class="fas fa-gauge-high"></i><span>Dashboard</span>
							</div>
							<div class="palette-item" draggable="true" data-type="report" title="Report">
								<i class="fas fa-chart-line"></i><span>Report</span>
							</div>
							<div class="palette-item" draggable="true"
								 data-consumption-type="powerbi" data-name="Power BI" data-category="Analytics"
								 data-icon="fas fa-chart-bar" data-icon-color="#F2C811" title="Power BI">
								<i class="fas fa-chart-bar" style="color: #F2C811;"></i><span>Power BI</span>
							</div>
							<div class="palette-item" draggable="true" data-type="tableau" title="Tableau">
								<i class="fas fa-chart-area" style="color: #E97627;"></i><span>Tableau</span>
							</div>
							<div class="palette-item" draggable="true" data-type="qlik" title="Qlik">
								<i class="fas fa-chart-pie" style="color: #009845;"></i><span>Qlik</span>
							</div>
						</div>
					</div>

					<!-- Governance & Security Category -->
			<div class="palette-category">
				<button class="category-header" onclick="togglePaletteCategory('governance-security', event)">
					<i class="fas fa-shield-alt"></i>
					<span>Governance & Security</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="governance-security">
							<!-- Data Catalog/Lineage -->
							<div class="palette-item" draggable="true" data-type="data-catalog" title="Data Catalog (Purview/OneLake Data Hub)">
								<i class="fas fa-search" style="color: #0078D4;"></i><span>Data Catalog</span>
							</div>
							<div class="palette-item" draggable="true" data-type="data-lineage" title="Data Lineage">
								<i class="fas fa-route" style="color: #6C757D;"></i><span>Data Lineage</span>
							</div>
							<div class="palette-item" draggable="true" data-type="purview" title="Microsoft Purview">
								<i class="fas fa-eye" style="color: #0078D4;"></i><span>Purview</span>
							</div>
							<div class="palette-item" draggable="true" data-type="onelake-hub" title="OneLake Data Hub">
								<i class="fas fa-hub" style="color: #5C2D91;"></i><span>OneLake Hub</span>
							</div>
                            
							<!-- Data Quality -->
							<div class="palette-item" draggable="true" data-type="data-quality" title="Data Quality Engine">
								<i class="fas fa-check-circle" style="color: #28A745;"></i><span>Data Quality</span>
							</div>
							<div class="palette-item" draggable="true" data-type="dq-rules" title="Data Quality Rules">
								<i class="fas fa-list-check" style="color: #17A2B8;"></i><span>DQ Rules</span>
							</div>
							<div class="palette-item" draggable="true" data-type="data-profiling" title="Data Profiling">
								<i class="fas fa-chart-pie" style="color: #FFC107;"></i><span>Data Profiling</span>
							</div>
                            
							<!-- Policy & Security -->
							<div class="palette-item" draggable="true" data-type="security-policy" title="Security Policy">
								<i class="fas fa-shield-check" style="color: #DC3545;"></i><span>Security Policy</span>
							</div>
							<div class="palette-item" draggable="true" data-type="rls" title="Row Level Security (RLS)">
								<i class="fas fa-user-shield" style="color: #6F42C1;"></i><span>RLS</span>
							</div>
							<div class="palette-item" draggable="true" data-type="abac" title="Attribute Based Access Control (ABAC)">
								<i class="fas fa-key" style="color: #E83E8C;"></i><span>ABAC</span>
							</div>
							<div class="palette-item" draggable="true" data-type="pii-classification" title="PII Classification">
								<i class="fas fa-user-secret" style="color: #FD7E14;"></i><span>PII Classification</span>
							</div>
							<div class="palette-item" draggable="true" data-type="data-classification" title="Data Classification">
								<i class="fas fa-tags" style="color: #20C997;"></i><span>Data Classification</span>
							</div>
						</div>
					</div>

					<!-- Data Access Category -->
			<div class="palette-category">
				<button class="category-header" onclick="togglePaletteCategory('data-access', event)">
					<i class="fas fa-key"></i>
					<span>Data Access</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="data-access">
							<div class="palette-item" draggable="true"
								 data-consumption-type="sql-endpoint" data-name="SQL Endpoint" data-category="Data Access"
								 data-icon="fas fa-database" data-icon-color="#0078D4" title="SQL Endpoint">
								<i class="fas fa-database" style="color: #0078D4;"></i><span>SQL Endpoint</span>
							</div>
							<div class="palette-item" draggable="true"
								 data-consumption-type="excel" data-name="Excel" data-category="Productivity"
								 data-icon="fas fa-file-excel" data-icon-color="#217346" title="Excel">
								<i class="fas fa-file-excel" style="color: #217346;"></i><span>Excel</span>
							</div>
							<div class="palette-item" draggable="true" data-type="rest-api" title="REST API">
								<i class="fas fa-globe"></i><span>REST API</span>
							</div>
							<div class="palette-item" draggable="true" data-type="graphql" title="GraphQL">
								<i class="fas fa-project-diagram" style="color: #E10098;"></i><span>GraphQL</span>
							</div>
							<div class="palette-item" draggable="true" data-type="odata" title="OData">
								<i class="fas fa-link"></i><span>OData</span>
							</div>
						</div>
					</div>
					
					<!-- Saved Layouts Category -->
			<div class="palette-category">
				<button class="category-header" onclick="togglePaletteCategory('saved-layouts', event)">
					<i class="fas fa-bookmark"></i>
					<span>Saved Layouts</span>
					<i class="fas fa-chevron-right toggle-icon"></i>
				</button>
						<div class="category-items" id="saved-layouts">
							<div class="palette-item" onclick="loadTemplate()" title="Load Template">
								<i class="fas fa-folder-open"></i><span>Load Template</span>
							</div>
							<div class="palette-item" onclick="saveAsTemplate()" title="Save Current Layout">
								<i class="fas fa-save"></i><span>Save as Template</span>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Raspberry Pi monitoring overlays -->
			<div class="pi-overlay-layer" aria-live="polite">
				<aside class="pi-info-panel" id="pi-info-panel" aria-live="polite" aria-label="Raspberry Pi details">
					<div class="pi-info-header">
						<div class="pi-info-chip" id="pi-info-chip">Pi #1</div>
						<button class="pi-info-close" id="pi-info-close" type="button" aria-label="Close Pi details">
							<i class="fas fa-times"></i>
						</button>
					</div>
					<div class="pi-info-meta">
						<div>
							<h3 id="pi-info-title">Select a Raspberry Pi</h3>
							<p id="pi-info-role">Tap a Pi card on the canvas to inspect live metrics.</p>
						</div>
						<div class="pi-info-health" id="pi-info-health" data-level="healthy">Online</div>
					</div>
					<div class="pi-info-body" id="pi-info-body">
						<p class="pi-info-empty">No node selected yet.</p>
					</div>
				</aside>
			</div>

			<!-- Main Workspace - Canvas + Inspector Layout -->
			<div class="fabric-main-workspace">
				<!-- Canvas Area -->
				<div class="fabric-canvas" id="fabric-canvas">
					<!-- Background layout (non-interactive) - Single large area -->
					<div class="canvas-background" aria-hidden="true">
						<div class="bg-panel bg-prepare">
							<div class="bg-title">Architecture Canvas</div>
						</div>
					</div>

					<!-- Zoom Level Indicator -->
					<div id="zoom-indicator" class="zoom-indicator">
						<i class="fas fa-search"></i>
						<span id="zoom-level-text">100%</span>
					</div>

					<!-- Dynamic items will be added here via JavaScript -->
				</div>
                
				<!-- Inspector Side Panel -->
				<div id="inspector-panel" class="inspector-panel collapsed">
					<div class="inspector-toggle" id="inspector-toggle">
						<i class="fas fa-chevron-left"></i>
					</div>
					<div class="inspector-content">
						<div class="inspector-header">
							<div class="inspector-title">
								<i class="fas fa-circle-info"></i>
								<span id="mp-node-title">Properties</span>
							</div>
						</div>
						<div class="inspector-body" id="metadata-panel-body">
							<div class="mp-section" data-section="business">
								<div class="mp-section-header">Business</div>
								<div class="mp-field">
									<label>Name</label>
									<input type="text" id="mp-name" placeholder="Display name">
								</div>
								<div class="mp-field">
									<label>Purpose</label>
									<textarea id="mp-purpose" rows="2" placeholder="Business purpose / value"></textarea>
								</div>
								<div class="mp-field">
									<label>Owner / Stakeholder</label>
									<input type="text" id="mp-owner" placeholder="Team or person">
								</div>
								<div class="mp-field-group-inline">
									<div class="mp-field">
										<label>Criticality</label>
										<select id="mp-criticality">
											<option value="">--</option>
											<option value="low">Low</option>
											<option value="medium">Medium</option>
											<option value="high">High</option>
											<option value="mission">Mission Critical</option>
										</select>
									</div>
									<div class="mp-field">
										<label>Status</label>
										<select id="mp-status">
											<option value="">--</option>
											<option value="planned">Planned</option>
											<option value="design">In Design</option>
											<option value="build">In Build</option>
											<option value="active">Active</option>
										</select>
									</div>
								</div>
							</div>
							<div class="mp-section" data-section="technical">
								<div class="mp-section-header">Technical</div>
								<div class="mp-field-group-inline">
									<div class="mp-field">
										<label>Type</label>
										<input type="text" id="mp-type" disabled>
									</div>
									<div class="mp-field">
										<label>Refresh</label>
										<select id="mp-refresh">
											<option value="">--</option>
											<option value="manual">Manual</option>
											<option value="hourly">Hourly</option>
											<option value="daily">Daily</option>
											<option value="weekly">Weekly</option>
											<option value="realtime">Real-time</option>
										</select>
									</div>
								</div>
								<div class="mp-field-group-inline">
									<div class="mp-field">
										<label>Volume</label>
										<input type="text" id="mp-volume" placeholder="e.g. 2TB / 5M rows">
									</div>
									<div class="mp-field">
										<label>Latency Tolerance</label>
										<input type="text" id="mp-latency" placeholder="e.g. 15 min">
									</div>
								</div>
							</div>
							<div class="mp-section" data-section="notes">
								<div class="mp-section-header">Notes</div>
								<div class="mp-field">
									<textarea id="mp-notes" rows="5" placeholder="Freeform notes, assumptions, risks..."></textarea>
								</div>
							</div>
							<div class="mp-footer" id="mp-footer">
								<div class="mp-status-line">
									<span id="mp-dirty-indicator" class="mp-dirty hidden">● Unsaved</span>
									<span id="mp-saved-indicator" class="mp-saved">Saved</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- End Inspector Panel -->
			</div>
		</div>
	</div>

	<!-- Database Selection Modal -->
	<div class="database-modal" id="database-modal" style="display: none;">
		<div class="database-modal-content">
			<div class="database-modal-header">
				<h3><i class="fas fa-database"></i> Select Databases to Add</h3>
				<button class="database-modal-close" id="database-modal-close">&times;</button>
			</div>
			<div class="database-modal-body">
				<div class="database-grid">
					<div class="database-option" data-db-name="SQL Server" data-db-type="SQL Server" data-icon="fas fa-server">
						<input type="checkbox" class="db-checkbox" id="db-sqlserver">
						<div class="db-icon"><i class="fas fa-server"></i></div>
						<div class="db-info">
							<div class="db-name">SQL Server</div>
							<div class="db-type">Microsoft SQL Server</div>
						</div>
					</div>
                    
					<div class="database-option" data-db-name="MySQL" data-db-type="MySQL" data-icon="fas fa-database">
						<input type="checkbox" class="db-checkbox" id="db-mysql">
						<div class="db-icon"><i class="fas fa-database"></i></div>
						<div class="db-info">
							<div class="db-name">MySQL</div>
							<div class="db-type">MySQL Database</div>
						</div>
					</div>
                    
					<div class="database-option" data-db-name="PostgreSQL" data-db-type="PostgreSQL" data-icon="fas fa-database">
						<input type="checkbox" class="db-checkbox" id="db-postgresql">
						<div class="db-icon"><i class="fas fa-database"></i></div>
						<div class="db-info">
							<div class="db-name">PostgreSQL</div>
							<div class="db-type">PostgreSQL Database</div>
						</div>
					</div>
                    
					<div class="database-option" data-db-name="Oracle" data-db-type="Oracle" data-icon="fas fa-database">
						<input type="checkbox" class="db-checkbox" id="db-oracle">
						<div class="db-icon"><i class="fas fa-database"></i></div>
						<div class="db-info">
							<div class="db-name">Oracle</div>
							<div class="db-type">Oracle Database</div>
						</div>
					</div>
                    
					<div class="database-option" data-db-name="MongoDB" data-db-type="NoSQL" data-icon="fas fa-leaf">
						<input type="checkbox" class="db-checkbox" id="db-mongodb">
						<div class="db-icon"><i class="fas fa-leaf"></i></div>
						<div class="db-info">
							<div class="db-name">MongoDB</div>
							<div class="db-type">Document Database</div>
						</div>
					</div>
                    
					<div class="database-option" data-db-name="Redis" data-db-type="Cache" data-icon="fas fa-memory">
						<input type="checkbox" class="db-checkbox" id="db-redis">
						<div class="db-icon"><i class="fas fa-memory"></i></div>
						<div class="db-info">
							<div class="db-name">Redis</div>
							<div class="db-type">In-Memory Cache</div>
						</div>
					</div>
                    
					<div class="database-option" data-db-name="Atlas" data-db-type="Custom" data-icon="fas fa-server">
						<input type="checkbox" class="db-checkbox" id="db-atlas">
						<div class="db-icon"><i class="fas fa-server"></i></div>
						<div class="db-info">
							<div class="db-name">Atlas</div>
							<div class="db-type">Custom Database</div>
						</div>
					</div>
                    
					<div class="database-option" data-db-name="QAS" data-db-type="Custom" data-icon="fas fa-server">
						<input type="checkbox" class="db-checkbox" id="db-qas">
						<div class="db-icon"><i class="fas fa-server"></i></div>
						<div class="db-info">
							<div class="db-name">QAS</div>
							<div class="db-type">Quality Assurance DB</div>
						</div>
					</div>
                    
					<div class="database-option" data-db-name="Procapita" data-db-type="Cloud" data-icon="fas fa-cloud">
						<input type="checkbox" class="db-checkbox" id="db-procapita">
						<div class="db-icon"><i class="fas fa-cloud"></i></div>
						<div class="db-info">
							<div class="db-name">Procapita</div>
							<div class="db-type">Cloud Service</div>
						</div>
					</div>
				</div>
			</div>
			<div class="database-modal-footer">
				<button class="btn btn-secondary" id="select-all-btn">Select All</button>
				<button class="btn btn-secondary" id="clear-all-btn">Clear All</button>
				<button class="btn btn-primary" id="add-selected-btn">Add Selected</button>
			</div>
		</div>
	</div>

	<!-- Settings Modal -->
	<div id="settings-modal" class="modal" aria-hidden="true" style="display: none;">
		<div class="modal-content settings-modal-content">
			<div class="modal-header">
				<h3><i class="fas fa-sliders-h" style="color: var(--primary-color)"></i> Canvas & Line Settings</h3>
				<button class="modal-close" id="settings-close" aria-label="Close settings">&times;</button>
			</div>
			<div class="modal-body">
				<!-- Two Column Layout -->
				<div class="settings-columns">
					<!-- Left Column: Connection Lines -->
					<div class="settings-column">
						<!-- Connection Colors -->
						<div class="settings-section">
							<div class="settings-section-header">
								<i class="fas fa-palette"></i>
								<h3>Connection Colors</h3>
							</div>
							<div class="settings-color-grid">
								<div class="form-group color-input-group">
									<label for="set-line-color">Flow Color</label>
									<div class="color-preview-wrapper">
										<input type="color" id="set-line-color" value="#f59e0b">
										<span class="color-hex">#f59e0b</span>
									</div>
								</div>
								<div class="form-group color-input-group">
									<label for="set-base-color">Base Path</label>
									<div class="color-preview-wrapper">
										<input type="color" id="set-base-color" value="#ffffff">
										<span class="color-hex">#ffffff</span>
									</div>
								</div>
								<div class="form-group color-input-group">
									<label for="set-arrow-color">Arrows</label>
									<div class="color-preview-wrapper">
										<input type="color" id="set-arrow-color" value="#ffffff">
										<span class="color-hex">#ffffff</span>
									</div>
								</div>
							</div>
							<div class="form-group slider-group">
								<label for="set-glow">
									<span class="slider-label">Glow Intensity</span>
									<span class="slider-value" id="glow-value">0.85</span>
								</label>
								<input type="range" id="set-glow" min="0" max="1" step="0.05" value="0.85">
							</div>
						</div>

						<!-- Line Style -->
						<div class="settings-section">
							<div class="settings-section-header">
								<i class="fas fa-pen-nib"></i>
								<h3>Line Style</h3>
							</div>
							<div class="form-group">
								<label for="set-connection-style">Connection Type</label>
								<select id="set-connection-style" class="settings-select">
									<option value="orthogonal">⊾ Orthogonal (Right-Angle)</option>
									<option value="curved">∿ Curved (Bezier)</option>
								</select>
							</div>
							<div class="form-group slider-group">
								<label for="set-width">
									<span class="slider-label">Line Width</span>
									<span class="slider-value"><span id="width-value">3</span>px</span>
								</label>
								<input type="range" id="set-width" min="1" max="8" step="1" value="3">
							</div>
							<div class="settings-inline-group">
								<div class="form-group slider-group">
									<label for="set-dash-a">
										<span class="slider-label">Dash</span>
										<span class="slider-value" id="dash-a-value">14</span>
									</label>
									<input type="range" id="set-dash-a" min="0" max="40" step="1" value="14">
								</div>
								<div class="form-group slider-group">
									<label for="set-dash-b">
										<span class="slider-label">Gap</span>
										<span class="slider-value" id="dash-b-value">10</span>
									</label>
									<input type="range" id="set-dash-b" min="0" max="40" step="1" value="10">
								</div>
							</div>
						</div>
					</div>

					<!-- Right Column: Animation & Elements -->
					<div class="settings-column">
						<!-- Animation -->
						<div class="settings-section">
							<div class="settings-section-header">
								<i class="fas fa-play-circle"></i>
								<h3>Animation</h3>
							</div>
							<div class="form-group toggle-group">
								<label class="toggle-label">
									<input type="checkbox" id="set-animate-lines" checked>
									<span class="toggle-switch"></span>
									<span class="toggle-text">Animate Connections</span>
								</label>
							</div>
							<div class="form-group slider-group">
								<label for="set-speed">
									<span class="slider-label">Flow Speed</span>
									<span class="slider-value"><span id="speed-value">1.1</span>s</span>
								</label>
								<input type="range" id="set-speed" min="0.2" max="5" step="0.1" value="1.1">
								<div class="slider-hints">
									<span>Fast</span>
									<span>Slow</span>
								</div>
							</div>
						</div>

						<!-- Canvas Elements -->
						<div class="settings-section">
							<div class="settings-section-header">
								<i class="fas fa-shapes"></i>
								<h3>Canvas Elements</h3>
							</div>
							<div class="form-group slider-group">
								<label for="set-item-size">
									<span class="slider-label">Element Scale</span>
									<span class="slider-value"><span id="item-size-value">1.0</span>x</span>
								</label>
								<input type="range" id="set-item-size" min="0.5" max="2.0" step="0.1" value="1.0">
								<div class="slider-hints">
									<span>50%</span>
									<span>200%</span>
								</div>
							</div>
							<div class="form-group toggle-group">
								<label class="toggle-label">
									<input type="checkbox" id="set-show-arrows" checked>
									<span class="toggle-switch"></span>
									<span class="toggle-text">Show Direction Arrows</span>
								</label>
							</div>
						</div>
					</div>
				</div>
                
				<div class="settings-actions">
					<button id="settings-reset" class="btn btn-secondary">
						<i class="fas fa-undo"></i> Reset Defaults
					</button>
					<button id="settings-apply" class="btn btn-primary">
						<i class="fas fa-check"></i> Apply & Close
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- PDF libraries (no SRI to avoid local blocking) -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	
	<!-- Core Application (contains all functionality) -->
	<script src="playground.js"></script>
	
	<!-- 
	MODULAR COMPONENTS (disabled - code still in playground.js)
	To enable modular architecture:
	1. Remove duplicated code from playground.js
	2. Uncomment the module scripts below
	
	<script src="modules/ui/canvas-settings.js"></script>
	<script src="modules/ui/page-manager.js"></script>
	<script src="modules/ui/metadata-panel.js"></script>
	<script src="modules/features/export.js"></script>
	<script src="modules/features/raspberry-pi.js"></script>
	<script src="modules/utils/presentation-mode.js"></script>
	<script src="modules/utils/palette-utils.js"></script>
	<script src="modules/utils/global-functions.js"></script>
	<script src="modules/playground-main.js"></script>
	-->
</body>
<script>
// Note: togglePaletteCategory is defined in playground.js

// Simple PDF export with Shift+click compatibility
document.addEventListener('DOMContentLoaded', function() {
	// Keep backward compatibility with Shift+click for quick snapshot
	document.addEventListener('keydown', function(e) {
		if (e.shiftKey && e.target.closest('.dropdown-item')) {
			e.preventDefault();
			if(typeof exportPDF === 'function'){
				exportPDF({quick: true});
			}
		}
	});
});
</script>
</html>

<!-- Text formatting toolbar: 2025-10-02 21:25:57 -->
